language: python
python:
  - '3.7'
matrix:
  include:
    - python: '3.7'
      dist: xenial
      sudo: true
env:
  - SH=bash
  - PYTHONPATH=.lib/
install:
  - pip install -t .lib/ -r requirements/test.txt
script:
  - pytest --cov-report=xml --cov=extractor
  - flake8
  - pylint **/*.py
after_success:
  - codecov
before_deploy:
  # uninstall all test dependencies
  - rm -rf .lib
  - pip install -t .lib/ -r requirements/base.txt
deploy:
  provider: lambda
  function_name: tank-level-extractor
  region: us-east-1
  role: arn:aws:iam::980858071036:role/service-role/tank-levels
  runtime: python3.7
  module_name: extractor/extractor
  handler_name: extract
  environment_variables:
    - PYTHONPATH=.lib/
